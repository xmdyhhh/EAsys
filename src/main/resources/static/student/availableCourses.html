<!DOCTYPE html>
<html lang="en">
<head>
    <base href="http://localhost:8080">
    <meta charset="UTF-8">
    <title>可选课程</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <style>
        .layui-table {
            margin-top: 20px;
        }

        .layui-btn {
            margin-right: 5px;
        }

        .layui-btn-normal {
            background-color: #009688;
        }
    </style>
</head>
<body>

<!-- 表格容器 -->
<table class="layui-table" id="datalist" lay-filter="datalist"></table>

<!-- 行内工具栏模板 -->
<script type="text/html" id="linetools">
    <button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="select">选择</button>
</script>

<!-- Layui 引入 -->
<script src="/layui/layui.all.js"></script>
<script>
    layui.use(['table', 'layer', 'jquery'], function () {
        const table = layui.table;
        const layer = layui.layer;
        const $ = layui.jquery;

        // 初始化表格
        table.render({
            elem: '#datalist',
            url: '/enrollment/availablelist',
            page: true,
            limit: 10,
            cols: [[
                {field: 'courseid', title: '课程ID'},
                {field: 'coursename', title: '课程名称'},
                {field: 'credits', title: '学分'},
                {field: 'semester', title: '学期'},
                {field: 'maxenrollment', title: '最大容量'},
                {field: 'currentenrollment', title: '当前人数'},
                {field: 'dayofweek', title: '上课星期'},
                {field: 'starttime', title: '开始时间'},
                {field: 'endtime', title: '结束时间'},
                {field: 'classroom', title: '教室'},
                {field: 'teachername', title: '任课教师'},
                {toolbar: '#linetools', title: '操作'}
            ]],
            response: {
                statusName: 'code',
                statusCode: 0,
                msgName: 'message',
                countName: 'count',
                dataName: 'data'
            }
        });

        // 行内操作监听
        table.on("tool(datalist)", function (obj) {
            var event = obj.event;
            var data = obj.data;

            if (event === 'select') {
                layer.confirm("确认要选择该课程吗?", function () {
                    $.ajax({
                        url: "/enrollment/selectcourse",
                        method: "POST",
                        data: {courseid: data.courseid},
                        success: function (result) {
                            if (result.code === 0) {
                                layer.closeAll();
                                table.reload("datalist");
                                layer.msg(result.message || "选择成功", {icon: 1, time: 1800});
                            } else {
                                layer.msg(result.message || "选课失败", {icon: 2, time: 1800});
                            }
                        },
                        error: function () {
                            layer.msg("服务器错误，请重试", {icon: 2, time: 1800});
                        }
                    });
                });
            }
        });
    });
</script>

</body>
</html>
